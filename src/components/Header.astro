---
import Logo from "./Logo.astro";
import Icon from "../components/Icon.astro";
import { SITE_TITLE } from "../config";
import navLinks from "../data/nav-links.json";
import socialLinks from "../data/social-links.json";

const currentPath = Astro.url.pathname;
---

<a
  class="font-exteded sr-only top-2 z-10 rounded-lg bg-page text-lg focus:not-sr-only focus:absolute focus:ml-2 focus:px-2 focus:py-1 focus:outline-offset-0"
  href="#maincontent">Skip Navigation</a
>

<header
  class="fixed flex w-full flex-col lg:h-dvh lg:w-64 lg:overflow-x-scroll lg:border-b-0 lg:border-r-2 lg:border-border"
  x-data="{ isOpen: false }"
  @keydown.escape="isOpen = false">
  <!-- Logo -->
  <div
    class="relative z-10 flex min-h-[--nav-item-height] items-center divide-x-2 divide-border border-y-2 border-border bg-page pl-4 lg:min-h-24 lg:border-t-0 lg:px-5">
    <a
      class="flex-grow transition-colors duration-500 hover:text-primary focus:text-primary"
      href="/">
      <Logo class="max-w-28 lg:max-w-40" />
      <h1 class="sr-only">{SITE_TITLE}</h1>
    </a>
    <button
      x-on:click="isOpen = ! isOpen"
      class="font-exteded self-stretch px-4 text-base leading-none transition-all hover:bg-page-offset hover:text-body hover:opacity-100 focus-visible:text-body focus-visible:opacity-100 lg:hidden"
      :class="isOpen ? 'text-base bg-page-offset' : ' text-muted'"
      :aria-expanded="isOpen"
      aria-controls="nav-menu">Menu</button
    >
  </div>

  <div
    id="nav-menu"
    class="relative z-0 flex-1 flex-col overflow-x-scroll bg-page transition-all motion-reduce:transition-none lg:!flex"
    @click.away="isOpen = false"
    x-show="isOpen"
    x-transition:enter-start="[clip-path:polygon(0%_0,_100%_0%,_100%_0%,_0_0%)] -translate-y-6"
    x-transition:enter-end="[clip-path:polygon(0%_0,_100%_0%,_100%_100%,_0_100%)] translate-y-0"
    x-transition:leave-start="[clip-path:polygon(0%_0,_100%_0%,_100%_100%,_0_100%)] translate-y-0"
    x-transition:leave-end="[clip-path:polygon(0%_0,_100%_0%,_100%_0%,_0_0%)] -translate-y-6">
    <!-- Nav -->
    <nav
      class="font-exteded flex flex-col divide-y-2 divide-border border-b-2 border-border text-base lg:text-lg">
      {
        navLinks.map(({ name, url, icon }) => (
          <a
            href={url}
            class:list={[
              "group flex min-h-[--nav-item-height] items-center gap-2.5 px-5 py-4 leading-none opacity-85 transition-all hover:bg-page-offset hover:text-body hover:opacity-100 focus:text-body focus:opacity-100 focus:-outline-offset-8",
              { "text-body opacity-100": currentPath === url },
              { "text-muted opacity-80": currentPath !== url },
            ]}>
            <Icon
              icon={icon}
              class:list={[
                "text-lg text-muted transition-colors group-hover:stroke-primary-dark group-focus:stroke-primary-dark lg:text-[1.375rem] ",
                { "stroke-primary-dark": currentPath === url },
                { "stroke-muted": currentPath !== url },
              ]}
            />
            {name}
          </a>
        ))
      }
    </nav>

    <!-- Social Links -->
    <footer class="mt-auto">
      <h2 class="sr-only">Social Media</h2>
      <ul
        class="-mt-0.5 flex min-h-[--nav-item-height] items-center gap-2 border-y-2 border-border bg-page-offset px-5 text-lg sm:justify-center lg:justify-between lg:text-xl">
        <li class="order-last hidden sm:block lg:hidden">
          <h3
            class="font-mono text-base leading-tight tracking-tighter text-muted">
            <span class="mr-3 text-muted opacity-50">&mdash;</span>Follow Us
          </h3>
        </li>
        {
          socialLinks.map(({ name, url, icon }) => (
            <li>
              <a
                class="px-1 text-muted transition-colors hover:text-primary-dark focus:text-primary-dark"
                href={url}>
                <span class="sr-only">{name}</span>
                <Icon icon={icon} />
              </a>
            </li>
          ))
        }
      </ul>
    </footer>
  </div>
</header>
